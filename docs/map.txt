  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                          NEWSLICER.PY LOGIC MAP                              â•‘                                                                  
  â•‘                    FAA Chart Processing System Flow                          â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                  
  â”‚                            START: main()                                     â”‚                                                                  
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                  
                                   â”‚                                                                                                                
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                  
                      â”‚  Parse CLI Arguments     â”‚                                                                                                  
                      â”‚  -s: source dir          â”‚                                                                                                  
                      â”‚  -o: output dir          â”‚                                                                                                  
                      â”‚  -c: CSV file            â”‚                                                                                                  
                      â”‚  -b: shapefiles dir      â”‚                                                                                                  
                      â”‚  -f: format (geotiff/    â”‚                                                                                                  
                      â”‚      mbtiles/tiles/both) â”‚                                                                                                  
                      â”‚  -z: zoom levels         â”‚                                                                                                  
                      â”‚  -r: resample algorithm  â”‚                                                                                                  
                      â”‚  --preview: dry-run      â”‚
                      â”‚  --download-delay: secs  â”‚
                      â”‚  --parallel-mbtiles: N   â”‚
                      â”‚      (default: 6)        â”‚
                      â”‚  --mbtiles-only: skip    â”‚
                      â”‚      VRT/GeoTIFF         â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                  
                                   â”‚                                                                                                                
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                  
                      â”‚  Validate Paths          â”‚                                                                                                  
                      â”‚  - source exists?        â”‚                                                                                                  
                      â”‚  - csv exists?           â”‚                                                                                                  
                      â”‚  - shapefiles exists?    â”‚                                                                                                  
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                  
                                   â”‚                                                                                                                
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                  
                      â”‚ Create Output Dir        â”‚                                                                                                  
                      â”‚ mkdir -p output          â”‚                                                                                                  
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                  
                                   â”‚                                                                                                                
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                    
  â•‘                       INITIALIZATION PHASE                                 â•‘                                                                    
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                    
                                   â”‚                                                                                                                
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                          
              â”‚  ChartSlicer.__init__()                  â”‚                                                                                          
              â”‚  - Initialize directories                â”‚                                                                                          
              â”‚  - Set download delay (default: 8s)      â”‚                                                                                          
              â”‚  - Check GDAL ZSTD support               â”‚                                                                                          
              â”‚  - Set compression: ZSTD or LZW fallback â”‚                                                                                          
              â”‚  - Initialize SRS cache (empty dict)     â”‚                                                                                          
              â”‚  - Initialize dole_data (defaultdict)    â”‚                                                                                          
              â”‚  - Set abbreviations map                 â”‚                                                                                          
              â”‚  - Configure GDAL options:               â”‚                                                                                          
              â”‚    * GDAL_CACHEMAX (75% RAM, max 8GB)    â”‚                                                                                          
              â”‚    * GDAL_NUM_THREADS = ALL_CPUS         â”‚                                                                                          
              â”‚    * GDAL_SWATH_SIZE (cache size)        â”‚                                                                                          
              â”‚    * COMPRESS_OVERVIEW = DEFLATE         â”‚                                                                                          
              â”‚    * GDAL_TIFF_INTERNAL_MASK = YES       â”‚                                                                                          
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                          
                                     â”‚                                                                                                              
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                          
              â”‚  load_dole_data()                        â”‚                                                                                          
              â”‚  Open master_dole.csv                    â”‚                                                                                          
              â”‚  For each row:                           â”‚                                                                                          
              â”‚    - Extract date, download_link         â”‚                                                                                          
              â”‚    - Parse Wayback timestamp from URL    â”‚                                                                                          
              â”‚      (regex: /web/(\d{14})/)             â”‚                                                                                          
              â”‚    - Store in dole_data[date].append()   â”‚                                                                                          
              â”‚  Log: "Loaded N dates"                   â”‚                                                                                          
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                          
                                     â”‚                                                                                                              
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                 
                        â”‚  Preview Mode Check?    â”‚                                                                                                 
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                                 
                              â”‚YES          â”‚NO                                                                                                     
                              â”‚             â”‚                                                                                                       
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                                                                                       
                â”‚ preview_downloads() â”‚     â”‚                                                                                                       
                â”‚ - Build pivot table â”‚     â”‚                                                                                                       
                â”‚   dates Ã— locations â”‚     â”‚                                                                                                       
                â”‚ - Check file exists â”‚     â”‚                                                                                                       
                â”‚   âœ“ local           â”‚     â”‚                                                                                                       
                â”‚   ğŸ“¥ needs download  â”‚     â”‚                                                                                                      
                â”‚ - Show matrix       â”‚     â”‚                                                                                                       
                â”‚ - Display stats     â”‚     â”‚                                                                                                       
                â”‚ - EXIT              â”‚     â”‚                                                                                                       
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                                                                       
                                            â”‚                                                                                                       
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                    
  â•‘                      REVIEW REPORT GENERATION                              â•‘                                                                    
  â•‘                   (preview_mode = TRUE temporarily)                        â•‘                                                                    
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                    
                                           â”‚                                                                                                        
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  generate_review_report()                    â”‚                                                                                  
                  â”‚  - Get all locations from CSV                â”‚                                                                                  
                  â”‚  - Build csv_lookup: date â†’ location â†’ rec   â”‚                                                                                  
                  â”‚  - Sort dates (latest first)                 â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  For each DATE (sorted latestâ†’oldest):      â”‚                                                                                   
                  â”‚    For each LOCATION:                        â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                           
                       â”‚ Has CSV record for date/loc?   â”‚                                                                                           
                       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                           
                           â”‚YES                   â”‚NO                                                                                               
                           â”‚                      â”‚                                                                                                 
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
           â”‚ Check shapefile needed?  â”‚      â”‚ Mark as NOT FOUND â”‚                                                                                  
           â”‚ - SHAPEFILE_FREE? â†’ N/A  â”‚      â”‚ edition: N/A      â”‚                                                                                  
           â”‚ - Else: find_shapefile() â”‚      â”‚ shapefile: N/A    â”‚                                                                                  
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ source: NOT FOUND â”‚                                                                                  
                       â”‚                     â”‚ fallback: NO      â”‚                                                                                  
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
           â”‚ Find source files        â”‚                                                                                                             
           â”‚ find_files():            â”‚                                                                                                             
           â”‚   resolve_filename()     â”‚                                                                                                             
           â”‚   - .zip? â†’ dir/**.tif   â”‚                                                                                                             
           â”‚   - .tif? â†’ direct path  â”‚                                                                                                             
           â”‚   - Check exists locally â”‚                                                                                                             
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                             
                       â”‚                                                                                                                            
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                             
           â”‚ Files found?             â”‚                                                                                                             
           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                                             
               â”‚YES             â”‚NO                                                                                                                 
               â”‚                â”‚                                                                                                                   
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                  
     â”‚ Mark vrt_library  â”‚   â”‚ Has filename in   â”‚                                                                                                  
     â”‚ [loc][date]=True  â”‚   â”‚ CSV?              â”‚                                                                                                  
     â”‚ source: filenames â”‚   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                                  
     â”‚ fallback: NO      â”‚      â”‚YES        â”‚NO                                                                                                     
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚           â”‚                                                                                                       
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                        
                      â”‚ Mark as     â”‚    â”‚ source:         â”‚                                                                                        
                      â”‚ WILL        â”‚    â”‚ NOT IN CSV      â”‚                                                                                        
                      â”‚ DOWNLOAD    â”‚    â”‚ fallback: NO    â”‚                                                                                        
                      â”‚ vrt_library â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                        
                      â”‚ =True       â”‚                                                                                                               
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                               
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  Second Pass: Calculate Fallback Usage      â”‚                                                                                   
                  â”‚  For each date & location:                  â”‚                                                                                   
                  â”‚    - Get available dates â‰¤ current date     â”‚                                                                                   
                  â”‚    - Find most_recent available             â”‚                                                                                   
                  â”‚    - If most_recent â‰  current:              â”‚                                                                                   
                  â”‚      Set fallback = most_recent             â”‚                                                                                   
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  Calculate Statistics:                       â”‚                                                                                  
                  â”‚  - total_dates                               â”‚                                                                                  
                  â”‚  - total_locations                           â”‚                                                                                  
                  â”‚  - total_matches (num_files > 0)             â”‚                                                                                  
                  â”‚  - missing_matches (num_files = 0)           â”‚                                                                                  
                  â”‚  - fallback_count (fallback â‰  NO)            â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  Display Matrix Report:                      â”‚                                                                                  
                  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—          â”‚                                                                                  
                  â”‚  â•‘  PROCESSING REVIEW REPORT      â•‘          â”‚                                                                                  
                  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â”‚                                                                                  
                  â”‚  Date Ã— Location Matrix:                     â”‚                                                                                  
                  â”‚  - filename = direct match                   â”‚                                                                                  
                  â”‚  - --- = missing                             â”‚                                                                                  
                  â”‚  - (â†’MM-DD) = using fallback                 â”‚                                                                                  
                  â”‚  - (N files) = multiple files                â”‚                                                                                  
                  â”‚  + Show statistics                           â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  Save CSV Report:                            â”‚                                                                                  
                  â”‚  processing_review_YYYYMMDD_HHMMSS.csv       â”‚                                                                                  
                  â”‚  (Matrix format: Date Ã— Locations)           â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                       â”‚                                                                                                            
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                
                           â”‚ Ask User: Proceed?    â”‚                                                                                                
                           â”‚ (y/n)                 â”‚                                                                                                
                           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                                
                               â”‚NO            â”‚YES                                                                                                  
                               â”‚              â”‚                                                                                                     
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”‚                                                                                                     
                        â”‚ EXIT (0)    â”‚       â”‚                                                                                                     
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                                                                                                     
                                              â”‚                                                                                                     
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                  
                  â”‚  Set preview_mode = FALSE                    â”‚                                                                                  
                  â”‚  (Enable downloads for actual processing)    â”‚                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                  
                                              â”‚                                                                                                     
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                    
  â•‘                    DOWNLOAD PREPARATION PHASE                              â•‘                                                                    
  â•‘                      _download_missing_files()                             â•‘                                                                    
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                    
                                               â”‚                                                                                                    
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                 
                  â”‚  Collect Missing Files:                       â”‚                                                                                 
                  â”‚  For each date in dole_data:                  â”‚                                                                                 
                  â”‚    For each record:                           â”‚                                                                                 
                  â”‚      Get filename, download_link              â”‚                                                                                 
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                 
                                       â”‚                                                                                                            
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                            
                       â”‚ Check file exists locally?    â”‚                                                                                            
                       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                            
                           â”‚YES (skip)           â”‚NO (add to list)                                                                                  
                           â”‚                     â”‚                                                                                                  
                           â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                     
                           â”‚        â”‚ Is it a .zip file?      â”‚                                                                                     
                           â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                     
                           â”‚             â”‚YES           â”‚NO                                                                                         
                           â”‚             â”‚              â”‚                                                                                           
                           â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                
                           â”‚   â”‚ Check dir      â”‚   â”‚ Check .tif   â”‚                                                                                
                           â”‚   â”‚ exists?        â”‚   â”‚ file exists? â”‚                                                                                
                           â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                
                           â”‚         â”‚NO                â”‚NO                                                                                         
                           â”‚         â”‚                  â”‚                                                                                           
                           â”‚   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                
                           â”‚   â”‚ Add to missing_files list:        â”‚                                                                                
                           â”‚   â”‚ (filename, download_link,         â”‚                                                                                
                           â”‚   â”‚  location, date, is_zip)          â”‚                                                                                
                           â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                
                           â”‚                   â”‚                                                                                                    
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                    
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                  â”‚ Sort missing_files by date            â”‚                                                                                         
                  â”‚ (latest â†’ oldest)                     â”‚                                                                                         
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                         
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                  â”‚ Log stats:                            â”‚                                                                                         
                  â”‚ - Found N missing files               â”‚                                                                                         
                  â”‚ - Download throttle: Xs               â”‚                                                                                         
                  â”‚ - Estimated time: ~M minutes          â”‚                                                                                         
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                         
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                  â”‚ For each missing file [idx/total]:   â”‚                                                                                          
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                         
                                       â”‚                                                                                                            
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                            
                       â”‚ download_file()               â”‚                                                                                            
                       â”‚ - Throttle check:             â”‚                                                                                            
                       â”‚   elapsed < download_delay?   â”‚                                                                                            
                       â”‚   â†’ sleep(wait_time)          â”‚                                                                                            
                       â”‚ - Retry loop (max 3 retries)  â”‚                                                                                            
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                            
                                       â”‚                                                                                                            
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                
                           â”‚ HTTP GET with stream  â”‚                                                                                                
                           â”‚ - timeout: 300s       â”‚                                                                                                
                           â”‚ - 1MB chunks          â”‚                                                                                                
                           â”‚ - Log progress @10%   â”‚                                                                                                
                           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                                
                               â”‚SUCCESS      â”‚FAIL                                                                                                  
                               â”‚             â”‚                                                                                                      
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                     
                    â”‚ Update          â”‚   â”‚ Connection reset? â”‚                                                                                     
                    â”‚ last_download   â”‚   â”‚ â†’ Increase delay  â”‚                                                                                     
                    â”‚ timestamp       â”‚   â”‚   (Ã—1.5 + 5s)     â”‚                                                                                     
                    â”‚ Log âœ“ Downloadedâ”‚   â”‚ Exponential       â”‚                                                                                     
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚ backoff (5â†’10â†’20) â”‚                                                                                     
                               â”‚          â”‚ Retry or give up  â”‚                                                                                     
                               â”‚          â”‚ Log âœ— Failed      â”‚                                                                                     
                               â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                     
                               â”‚                                                                                                                    
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                         
                    â”‚ Is it a .zip file?  â”‚                                                                                                         
                    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                                                                                                         
                       â”‚YES           â”‚NO                                                                                                           
                       â”‚              â”‚                                                                                                             
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                                                                                              
           â”‚ extract_zip()     â”‚     â”‚                                                                                                              
           â”‚ - Open zipfile    â”‚     â”‚                                                                                                              
           â”‚ - extractall()    â”‚     â”‚                                                                                                              
           â”‚ - Count .tif      â”‚     â”‚                                                                                                              
           â”‚ - Log âœ“ Extracted â”‚     â”‚                                                                                                              
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                                                                              
                       â”‚              â”‚                                                                                                             
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                    
           â”‚ Sleep download_delay before next  â”‚                                                                                                    
           â”‚ (if not last file)                â”‚                                                                                                    
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                    
                           â”‚                                                                                                                        
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                  
                  â”‚ Log Download Summary:        â”‚                                                                                                  
                  â”‚ - Downloaded: N/total        â”‚                                                                                                  
                  â”‚ - Failed: M                  â”‚                                                                                                  
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                  
                               â”‚                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                   
  â•‘                         DATE PROCESSING LOOP                                â•‘                                                                   
  â•‘                        process_all_dates()                                  â•‘                                                                   
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                   
                                â”‚                                                                                                                   
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                             
           â”‚ Get all_locations from CSV               â”‚                                                                                             
           â”‚ - Extract unique normalized location     â”‚                                                                                             
           â”‚   names from all dates                   â”‚                                                                                             
           â”‚ - Sort alphabetically                    â”‚                                                                                             
           â”‚ - Count shapefiles available             â”‚                                                                                             
           â”‚ - Log: "Found N locations (M with        â”‚                                                                                             
           â”‚   shapefiles, K shapefile-free)"         â”‚                                                                                             
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                             
                                â”‚                                                                                                                   
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Initialize vrt_library:                  â”‚
           â”‚ Dict[location][date] â†’ Path to VRT/TIFF  â”‚
           â”‚ (Used for fallback logic)                â”‚
           â”‚                                          â”‚
           â”‚ Initialize mbtiles_jobs = []             â”‚
           â”‚ (Queue for deferred MBTiles creation)    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                             
                                â”‚                                                                                                                   
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                             
           â”‚ Sort dates (earliest â†’ latest)           â”‚                                                                                             
           â”‚ For each DATE [idx/total]:               â”‚                                                                                             
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                             
                                â”‚                                                                                                                   
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                             
           â”‚ Log: "Processing date: YYYY-MM-DD"       â”‚                                                                                             
           â”‚ Create temp_dir: output/.temp/date/      â”‚                                                                                             
           â”‚ Initialize warp_jobs list                â”‚                                                                                             
           â”‚ Initialize location_metadata dict        â”‚                                                                                             
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                             
                                â”‚                                                                                                                   
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                             
           â”‚ For each RECORD in date:                 â”‚                                                                                             
           â”‚   Get: location, edition, timestamp,     â”‚                                                                                             
           â”‚        filename, download_link           â”‚                                                                                             
           â”‚   norm_loc = normalize_name(location)    â”‚                                                                                             
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                             
                                â”‚                                                                                                                   
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                   
                â”‚ Is shapefile-free location?   â”‚                                                                                                   
                â”‚ (hawaiian_islands,             â”‚                                                                                                  
                â”‚  mariana_islands, etc.)        â”‚                                                                                                  
                â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                                  
                    â”‚YES                    â”‚NO                                                                                                     
                    â”‚                       â”‚                                                                                                       
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                                                                                                        
      â”‚ SHAPEFILE-FREE PATH    â”‚           â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                                                                                                        
                    â”‚                       â”‚                                                                                                       
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                                                                                        
      â”‚ find_files():                  â”‚   â”‚                                                                                                        
      â”‚   resolve_filename()           â”‚   â”‚                                                                                                        
      â”‚   - Check .zip dir or .tif     â”‚   â”‚                                                                                                        
      â”‚   - Return list of TIF paths   â”‚   â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                                                                                        
                    â”‚                       â”‚                                                                                                       
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                                                                                                       
        â”‚ Files found?       â”‚              â”‚                                                                                                       
        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚                                                                                                       
            â”‚NO        â”‚YES                 â”‚                                                                                                       
            â”‚          â”‚                    â”‚                                                                                                       
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”‚                    â”‚                                                                                                        
      â”‚ Log:     â”‚    â”‚                    â”‚                                                                                                        
      â”‚ "No src  â”‚    â”‚                    â”‚                                                                                                        
      â”‚ files"   â”‚    â”‚                    â”‚                                                                                                        
      â”‚ CONTINUE â”‚    â”‚                    â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                    â”‚                                                                                                        
                      â”‚                    â”‚                                                                                                        
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                                                                                                        
      â”‚ For each source TIF:        â”‚      â”‚                                                                                                        
      â”‚   Create temp warped file   â”‚      â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                                                                                        
                      â”‚                    â”‚                                                                                                        
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                                                                                                        
      â”‚ Manual Warp (no shapefile): â”‚      â”‚                                                                                                        
      â”‚ 1. Expand to RGBA (VRT)     â”‚      â”‚                                                                                                        
      â”‚    gdal.Translate(rgbExpand)â”‚      â”‚                                                                                                        
      â”‚ 2. Warp to EPSG:3857        â”‚      â”‚                                                                                                        
      â”‚    gdal.Warp():             â”‚      â”‚                                                                                                        
      â”‚    - dstSRS: EPSG:3857      â”‚      â”‚                                                                                                        
      â”‚    - dstAlpha: True         â”‚      â”‚                                                                                                        
      â”‚    - COMPRESS={compression} â”‚      â”‚                                                                                                        
      â”‚    - TILED=YES, BIGTIFF=YES â”‚      â”‚                                                                                                        
      â”‚    - PREDICTOR=2            â”‚      â”‚                                                                                                        
      â”‚    - multithread: True      â”‚      â”‚                                                                                                        
      â”‚ 3. Cleanup /vsimem VRT      â”‚      â”‚                                                                                                        
      â”‚ 4. Log âœ“ Warped (size MB)   â”‚      â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                                                                                        
                      â”‚                    â”‚                                                                                                        
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                                                                                                        
      â”‚ Build VRT from warped files â”‚      â”‚                                                                                                        
      â”‚ - If >1 file: build_vrt()   â”‚      â”‚                                                                                                        
      â”‚ - If 1 file: use directly   â”‚      â”‚                                                                                                        
      â”‚ Store in vrt_library        â”‚      â”‚                                                                                                        
      â”‚ [norm_loc][date] = vrt_path â”‚      â”‚                                                                                                        
      â”‚ CONTINUE to next record     â”‚      â”‚                                                                                                        
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                                                                                        
                                           â”‚                                                                                                        
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ SHAPEFILE-BASED PATH            â”‚                                                                                       
                          â”‚ (Normal sectional processing)   â”‚                                                                                       
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                       
                                           â”‚                                                                                                        
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ find_shapefile(location):       â”‚                                                                                       
                          â”‚ - Search sectional/*.shp        â”‚                                                                                       
                          â”‚ - Normalize names & match       â”‚                                                                                       
                          â”‚ - Cache SRS in srs_cache        â”‚                                                                                       
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                       
                                           â”‚                                                                                                        
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                           
                              â”‚ Shapefile found?        â”‚                                                                                           
                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                           
                                   â”‚NO            â”‚YES                                                                                              
                                   â”‚              â”‚                                                                                                 
                            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”‚                                                                                                 
                            â”‚ Log: "No    â”‚       â”‚                                                                                                 
                            â”‚ shapefile"  â”‚       â”‚                                                                                                 
                            â”‚ CONTINUE    â”‚       â”‚                                                                                                 
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                                                                                                 
                                                  â”‚                                                                                                 
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ find_files(loc, ed, ts, fn, dl) â”‚                                                                                       
                          â”‚   resolve_filename():            â”‚                                                                                      
                          â”‚   - .zip? â†’ dir/**.tif           â”‚                                                                                      
                          â”‚   - .tif? â†’ direct path          â”‚                                                                                      
                          â”‚   Returns: [(Path, None), ...]   â”‚                                                                                      
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                      
                                              â”‚                                                                                                     
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                                  â”‚ Files found?          â”‚                                                                                         
                                  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                         
                                      â”‚NO            â”‚YES                                                                                           
                                      â”‚              â”‚                                                                                              
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”‚                                                                                              
                              â”‚ Log: "No src  â”‚      â”‚                                                                                              
                              â”‚ files"        â”‚      â”‚                                                                                              
                              â”‚ CONTINUE      â”‚      â”‚                                                                                              
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                                                                              
                                                     â”‚                                                                                              
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ Log: "location (edition): file" â”‚                                                                                       
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                                       
                                                     â”‚                                                                                              
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ _prepare_warp_job():             â”‚                                                                                      
                          â”‚ For each source file:            â”‚                                                                                      
                          â”‚   Create job dict:               â”‚                                                                                      
                          â”‚   - input_tiff: src path         â”‚                                                                                      
                          â”‚   - shapefile: shp path          â”‚                                                                                      
                          â”‚   - output_tiff: temp path       â”‚                                                                                      
                          â”‚   - location: norm_loc           â”‚                                                                                      
                          â”‚   - date: date                   â”‚                                                                                      
                          â”‚ Append to warp_jobs list         â”‚                                                                                      
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                                       
                                                     â”‚                                                                                              
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                                                                       
                          â”‚ Store location_metadata:        â”‚                                                                                       
                          â”‚ location_metadata[norm_loc]     â”‚                                                                                       
                          â”‚   = {'edition': edition}        â”‚                                                                                       
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                                       
                                                     â”‚                                                                                              
                                                     â”‚                                                                                              
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                    
           â”‚ END OF RECORD LOOP                                â”‚                                                                                    
           â”‚ All records processed for this date               â”‚                                                                                    
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                    
                                         â”‚                                                                                                          
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                   
  â•‘                      PARALLEL WARP EXECUTION                                â•‘                                                                   
  â•‘                   (for shapefile-based locations)                           â•‘                                                                   
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                   
                                        â”‚                                                                                                           
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                   â”‚ warp_jobs list populated?            â”‚                                                                                         
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                                                         
                        â”‚YES                       â”‚NO (skip)                                                                                       
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                                                                                
           â”‚ Calculate CPU workers:      â”‚         â”‚                                                                                                
           â”‚ cpu_count_for_warp =        â”‚         â”‚                                                                                                
           â”‚   max(2, cpu_count - 2)     â”‚         â”‚                                                                                                
           â”‚ Log: "Processing N warp     â”‚         â”‚                                                                                                
           â”‚      jobs with M workers"   â”‚         â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                                                                                
           â”‚ ThreadPoolExecutor:         â”‚         â”‚                                                                                                
           â”‚ max_workers = M             â”‚         â”‚                                                                                                
           â”‚                             â”‚         â”‚                                                                                                
           â”‚ For each job in warp_jobs:  â”‚         â”‚                                                                                                
           â”‚   Submit _warp_worker(job)  â”‚         â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                                                                                
           â”‚ _warp_worker(job):          â”‚         â”‚                                                                                                
           â”‚   Call warp_and_cut()       â”‚         â”‚                                                                                                
           â”‚   Return result dict        â”‚         â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                                                                                
           â”‚ warp_and_cut():                     â”‚ â”‚                                                                                                
           â”‚ 1. Expand to RGBA:                  â”‚ â”‚                                                                                                
           â”‚    - Create /vsimem VRT             â”‚ â”‚                                                                                                
           â”‚    - gdal.Translate(rgbExpand=rgba) â”‚ â”‚                                                                                                
           â”‚ 2. Get shapefile SRS:               â”‚ â”‚                                                                                                
           â”‚    - get_shapefile_srs() [cached]   â”‚ â”‚                                                                                                
           â”‚    - OGR read layer.GetSpatialRef() â”‚ â”‚                                                                                                
           â”‚    - Export to Proj4 format         â”‚ â”‚                                                                                                
           â”‚ 3. Warp with cutline:               â”‚ â”‚                                                                                                
           â”‚    gdal.Warp():                     â”‚ â”‚                                                                                                
           â”‚    - format: GTiff                  â”‚ â”‚                                                                                                
           â”‚    - dstSRS: EPSG:3857              â”‚ â”‚                                                                                                
           â”‚    - cutlineDSName: shapefile       â”‚ â”‚                                                                                                
           â”‚    - cutlineSRS: shapefile_srs      â”‚ â”‚                                                                                                
           â”‚    - cropToCutline: True            â”‚ â”‚                                                                                                
           â”‚    - dstAlpha: True                 â”‚ â”‚                                                                                                
           â”‚    - resampleAlg: user choice       â”‚ â”‚                                                                                                
           â”‚    - COMPRESS={compression}         â”‚ â”‚                                                                                                
           â”‚    - TILED=YES, BIGTIFF=YES         â”‚ â”‚                                                                                                
           â”‚    - PREDICTOR=2                    â”‚ â”‚                                                                                                
           â”‚    - multithread: True              â”‚ â”‚                                                                                                
           â”‚    - CUTLINE_ALL_TOUCHED=TRUE       â”‚ â”‚                                                                                                
           â”‚ 4. Cleanup /vsimem VRT              â”‚ â”‚                                                                                                
           â”‚ 5. Return success/failure           â”‚ â”‚                                                                                                
           â”‚ 6. Log âœ“ or âœ— with file size       â”‚ â”‚                                                                                                 
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                                                                                
           â”‚ Collect results as futures  â”‚         â”‚                                                                                                
           â”‚ complete (as_completed())   â”‚         â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                                                                                
           â”‚ Group results by location:  â”‚         â”‚                                                                                                
           â”‚ temp_warped_by_location     â”‚         â”‚                                                                                                
           â”‚ [location] = [file1, ...]   â”‚         â”‚                                                                                                
           â”‚ (Validate: exists & >1KB)   â”‚         â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                                                                                
           â”‚ For each location with warped files:â”‚ â”‚                                                                                                
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                                                                
                        â”‚                          â”‚                                                                                                
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚                                                                                                
            â”‚ Multiple files (>1)?   â”‚             â”‚                                                                                                
            â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜             â”‚                                                                                                
                â”‚YES             â”‚NO               â”‚                                                                                                
                â”‚                â”‚                 â”‚                                                                                                
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                                                                                 
    â”‚ build_vrt():      â”‚   â”‚ Use single file â”‚   â”‚                                                                                                 
    â”‚ - Validate files  â”‚   â”‚ directly        â”‚   â”‚                                                                                                 
    â”‚ - Check size >1KB â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚ - gdal.BuildVRT() â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚   resampleAlg:    â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚   Bilinear        â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚   resolution:     â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚   highest         â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â”‚ - Log âœ“ Built VRT â”‚   â”‚                 â”‚   â”‚                                                                                                 
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                                                                                 
                â”‚                â”‚                 â”‚                                                                                                
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                                                                 
    â”‚ Store in vrt_library:                    â”‚  â”‚                                                                                                 
    â”‚ vrt_library[norm_loc][date] = vrt_path   â”‚  â”‚                                                                                                 
    â”‚ Log: "âœ“ VRT created" or "Single file"    â”‚  â”‚                                                                                                 
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                                                                 
                        â”‚                          â”‚                                                                                                
                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                
                        â”‚                                                                                                                           
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                          
           â”‚ Log: "Processed N locations â”‚                                                                                                          
           â”‚       with data"            â”‚                                                                                                          
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                          
                        â”‚                                                                                                                           
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                    
  â•‘                    FALLBACK LOGIC & MOSAIC CREATION                        â•‘                                                                    
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                    
                                       â”‚                                                                                                            
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                      
                  â”‚ Build date_matrix for this date:        â”‚                                                                                       
                  â”‚ For each location in all_locations:     â”‚                                                                                       
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                      
                                       â”‚                                                                                                            
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                            
                       â”‚ Does vrt_library have this    â”‚                                                                                            
                       â”‚ location?                     â”‚                                                                                            
                       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                            
                           â”‚YES                   â”‚NO (skip)                                                                                        
                           â”‚                      â”‚                                                                                                 
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                                                                                                 
           â”‚ Exact date match available?   â”‚      â”‚                                                                                                 
           â”‚ (date in vrt_library[loc])    â”‚      â”‚                                                                                                 
           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚                                                                                                 
               â”‚YES                   â”‚NO         â”‚                                                                                                 
               â”‚                      â”‚           â”‚                                                                                                 
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                               
     â”‚ Use exact match: â”‚   â”‚ FALLBACK LOGIC:       â”‚                                                                                               
     â”‚ date_matrix[loc] â”‚   â”‚ - Get all available   â”‚                                                                                               
     â”‚ = vrt_library    â”‚   â”‚   dates for location  â”‚                                                                                               
     â”‚   [loc][date]    â”‚   â”‚ - Sort chronologicallyâ”‚                                                                                               
     â”‚                  â”‚   â”‚ - Use most_recent     â”‚                                                                                               
     â”‚                  â”‚   â”‚   (last in sorted)    â”‚                                                                                               
     â”‚                  â”‚   â”‚ date_matrix[loc] =    â”‚                                                                                               
     â”‚                  â”‚   â”‚   vrt_library[loc]    â”‚                                                                                               
     â”‚                  â”‚   â”‚   [most_recent]       â”‚                                                                                               
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                               
                        â”‚           â”‚                                                                                                               
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                                                                               
                              â”‚                                                                                                                     
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                     
                  â”‚ date_matrix populated?    â”‚                                                                                                     
                  â”‚ (any locations?)          â”‚                                                                                                     
                  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                                                     
                      â”‚YES               â”‚NO                                                                                                        
                      â”‚                  â”‚                                                                                                          
                      â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                
                      â”‚        â”‚ Log: "Skipping    â”‚                                                                                                
                      â”‚        â”‚ date - no data"   â”‚                                                                                                
                      â”‚        â”‚ CONTINUE to next  â”‚                                                                                                
                      â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                
                      â”‚                                                                                                                             
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                             
      â”‚ Create mosaic_vrts list from  â”‚                                                                                                             
      â”‚ date_matrix.values()          â”‚                                                                                                             
      â”‚ Log: "Creating mosaic VRT     â”‚                                                                                                             
      â”‚       from N locations"       â”‚                                                                                                             
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                             
                      â”‚                                                                                                                             
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                             
      â”‚ build_vrt(mosaic_vrts,        â”‚                                                                                                             
      â”‚           mosaic_vrt):        â”‚                                                                                                             
      â”‚ - Validate all input files    â”‚                                                                                                             
      â”‚ - gdal.BuildVRT()             â”‚                                                                                                             
      â”‚   (combines all location VRTs)â”‚                                                                                                             
      â”‚ - Log âœ“ Mosaic VRT created    â”‚                                                                                                             
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                             
                      â”‚                                                                                                                             
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                    
  â•‘                         OUTPUT GENERATION                                  â•‘                                                                    
  â•‘              (Based on --format: geotiff/mbtiles/tiles/both)               â•‘                                                                    
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                    
                                               â”‚                                                                                                    
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                     
                  â”‚ Determine output_format (from CLI arg)   â”‚                                                                                      
                  â”‚ Determine zoom_levels (from CLI arg)     â”‚                                                                                      
                  â”‚ Check existing outputs:                  â”‚                                                                                      
                  â”‚ - geotiff_path: date.tif                 â”‚                                                                                      
                  â”‚ - mbtiles_path: date.mbtiles             â”‚                                                                                      
                  â”‚ - tiles_dir: date_tiles/                 â”‚                                                                                      
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                     
                                       â”‚                                                                                                            
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                            
                       â”‚ Check if outputs exist:       â”‚                                                                                            
                       â”‚ - geotiff: exists & >1MB?     â”‚                                                                                            
                       â”‚ - mbtiles: exists & >1MB?     â”‚                                                                                            
                       â”‚ - tiles: dir exists & has     â”‚                                                                                            
                       â”‚   **.webp files?              â”‚                                                                                            
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                            
                                       â”‚                                                                                                            
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                         
                   â”‚ Based on format, check if SKIP:     â”‚                                                                                          
                   â”‚ - geotiff: already exists?           â”‚                                                                                         
                   â”‚ - mbtiles: already exists?           â”‚                                                                                         
                   â”‚ - tiles: already exists?             â”‚                                                                                         
                   â”‚ - both: geotiff+tiles exist?         â”‚                                                                                         
                   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                         
                       â”‚SKIP                      â”‚PROCESS                                                                                          
                       â”‚                          â”‚                                                                                                 
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                                                                                                 
           â”‚ Log: "âŠ˜ Output       â”‚               â”‚                                                                                                 
           â”‚ already exists -     â”‚               â”‚                                                                                                 
           â”‚ skipping"            â”‚               â”‚                                                                                                 
           â”‚ Go to COMPLETE       â”‚               â”‚                                                                                                 
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                                                                                                 
                                                  â”‚                                                                                                 
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                
                              â”‚ Generate outputs based on format:  â”‚                                                                                
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                
                                                  â”‚                                                                                                 
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                          
           â”‚                                      â”‚                      â”‚                                                                          
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                                                   
      â”‚ format =    â”‚              â”‚ format = mbtiles    â”‚    â”‚ format = tiles  â”‚                                                                   
      â”‚ geotiff     â”‚              â”‚ OR                  â”‚    â”‚ OR              â”‚                                                                   
      â”‚ OR both     â”‚              â”‚ (not mbtiles)       â”‚    â”‚ both            â”‚                                                                   
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                                   
           â”‚                                  â”‚                         â”‚                                                                           
           â”‚                                  â”‚                         â”‚                                                                           
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ create_geotiff(): â”‚          â”‚ QUEUE MBTiles job      â”‚  â”‚ generate_tiles():  â”‚
  â”‚ (if not exists)   â”‚          â”‚ (if not exists)        â”‚  â”‚ (if not exists)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚                         â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ gdal.Translate():             â”‚           â”‚              â”‚ gdal2tiles.py       â”‚
  â”‚ - input: mosaic VRT           â”‚           â”‚              â”‚ subprocess call:    â”‚
  â”‚ - output: date.tif            â”‚           â”‚              â”‚ --zoom 0-11         â”‚
  â”‚ - format: GTiff               â”‚           â”‚              â”‚ --processes M       â”‚
  â”‚ - creationOptions:            â”‚           â”‚              â”‚ --webviewer=none    â”‚
  â”‚   * TILED=YES                 â”‚           â”‚              â”‚ --exclude           â”‚
  â”‚   * COMPRESS={compression}    â”‚           â”‚              â”‚ --tiledriver=WEBP   â”‚
  â”‚   * PREDICTOR=2               â”‚           â”‚              â”‚ --webp-quality=50   â”‚
  â”‚   * BIGTIFF=YES               â”‚           â”‚              â”‚ - timeout: 2 hours  â”‚
  â”‚   * BLOCKXSIZE=512            â”‚           â”‚              â”‚ Log âœ“ Tiles         â”‚
  â”‚   * BLOCKYSIZE=512            â”‚           â”‚              â”‚ generated           â”‚
  â”‚   * NUM_THREADS=ALL_CPUS      â”‚           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚ - Error handling for ZSTD     â”‚           â”‚
  â”‚   corruption â†’ retry with LZW â”‚           â”‚
  â”‚ - Log âœ“ GeoTIFF created       â”‚           â”‚
  â”‚   with file size              â”‚           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                              â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚ Append to mbtiles_jobs:    â”‚
                               â”‚ (mosaic_vrt, mbtiles_path) â”‚
                               â”‚                            â”‚
                               â”‚ Log: "Queuing MBTiles      â”‚
                               â”‚       creation..."         â”‚
                               â”‚                            â”‚
                               â”‚ (Actual creation deferred  â”‚
                               â”‚  to batch processing phase â”‚
                               â”‚  after ALL dates complete) â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                          
           â”‚                                                                                                                                        
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                                         
      â”‚ Log: "âœ“âœ“âœ“ DATE    â”‚                                                                                                                         
      â”‚ COMPLETE"         â”‚                                                                                                                         
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                         
           â”‚                                                                                                                                        
           â”‚                                                                                                                                        
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ CONTINUE to next date     â”‚
      â”‚ (back to date loop)       â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (All dates processed)
           â”‚
  â•”â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘                    PARALLEL MBTILES BATCH PROCESSING                      â•‘
  â•‘           (ProcessPoolExecutor for true CPU parallelism)                  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ mbtiles_jobs list populated?          â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚YES                        â”‚NO (skip)
                â”‚                           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
   â”‚ Get workers from CLI arg:    â”‚         â”‚
   â”‚ --parallel-mbtiles (def: 6)  â”‚         â”‚
   â”‚                              â”‚         â”‚
   â”‚ Log: "Processing N MBTiles   â”‚         â”‚
   â”‚       jobs in parallel       â”‚         â”‚
   â”‚       (M workers)"           â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
   â”‚ ProcessPoolExecutor:         â”‚         â”‚
   â”‚ max_workers = M              â”‚         â”‚
   â”‚                              â”‚         â”‚
   â”‚ For each job in mbtiles_jobs:â”‚         â”‚
   â”‚   Submit create_mbtiles_     â”‚         â”‚
   â”‚   worker(job)                â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
   â”‚ create_mbtiles_worker(args): â”‚         â”‚
   â”‚ (Module-level function for   â”‚         â”‚
   â”‚  multiprocessing pickle)     â”‚         â”‚
   â”‚                              â”‚         â”‚
   â”‚ 1. Re-import GDAL in process â”‚         â”‚
   â”‚    (required for subprocess) â”‚         â”‚
   â”‚ 2. gdal.Translate():         â”‚         â”‚
   â”‚    - input: mosaic VRT       â”‚         â”‚
   â”‚    - output: date.mbtiles    â”‚         â”‚
   â”‚    - format: MBTiles         â”‚         â”‚
   â”‚    - creationOptions:        â”‚         â”‚
   â”‚      * TILE_FORMAT=WEBP      â”‚         â”‚
   â”‚      * QUALITY=85            â”‚         â”‚
   â”‚      * ZOOM_LEVEL_STRATEGY=  â”‚         â”‚
   â”‚        AUTO                  â”‚         â”‚
   â”‚ 3. Return (success, path,    â”‚         â”‚
   â”‚    size_mb, error)           â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
   â”‚ as_completed() loop:         â”‚         â”‚
   â”‚ For each completed future:   â”‚         â”‚
   â”‚   [i/total] âœ“ MBTiles        â”‚         â”‚
   â”‚   created: name (size MB)    â”‚         â”‚
   â”‚   OR                         â”‚         â”‚
   â”‚   [i/total] âœ— Failed: error  â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                â”‚                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Log: "=== Processing Complete ==="    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ EXIT                                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                 
                                                                                                                                                    
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                            KEY HELPER FUNCTIONS                              â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  normalize_name(name)                                                                                                                              
  â”œâ”€ Strip, lowercase, replace spaces/dashes/dots with underscores                                                                                  
  â”œâ”€ Collapse multiple underscores                                                                                                                  
  â””â”€ Apply abbreviations map (hawaiian_is â†’ hawaiian_islands, etc.)                                                                                 
                                                                                                                                                    
  sanitize_filename(name)                                                                                                                           
  â”œâ”€ Replace spaces, dashes, dots with underscores                                                                                                  
  â”œâ”€ Remove parentheses and commas                                                                                                                  
  â”œâ”€ Collapse multiple underscores                                                                                                                  
  â””â”€ Lowercase                                                                                                                                      
                                                                                                                                                    
  resolve_filename(filename, download_link) â†’ List[(Path, None)]                                                                                    
  â”œâ”€ Case 1: .zip file                                                                                                                              
  â”‚  â”œâ”€ Check if dir_name/ exists (fast path)                                                                                                       
  â”‚  â”œâ”€ Walk source_dir to find dir_name/                                                                                                           
  â”‚  â”œâ”€ Find all .tif files in dir: glob('**/*.tif')                                                                                                
  â”‚  â””â”€ If not found & download_link: download & extract                                                                                            
  â”œâ”€ Case 2: .tif file                                                                                                                              
  â”‚  â”œâ”€ Check if file exists directly (fast path)                                                                                                   
  â”‚  â”œâ”€ Walk source_dir to find filename                                                                                                            
  â”‚  â””â”€ If not found & download_link: download                                                                                                      
  â””â”€ Return list of (Path, None) tuples                                                                                                             
                                                                                                                                                    
  find_shapefile(location) â†’ Optional[Path]                                                                                                         
  â”œâ”€ Normalize location name                                                                                                                        
  â”œâ”€ Search sectional/*.shp only (not TAC/Terminal/Helicopter)                                                                                      
  â”œâ”€ Match normalized shapefile stem to location                                                                                                    
  â””â”€ Return first match or None                                                                                                                     
                                                                                                                                                    
  get_shapefile_srs(shapefile) â†’ str                                                                                                                
  â”œâ”€ Check srs_cache first                                                                                                                          
  â”œâ”€ Open shapefile with OGR                                                                                                                        
  â”œâ”€ Get layer SpatialRef                                                                                                                           
  â”œâ”€ Export to Proj4 format                                                                                                                         
  â”œâ”€ Cache result                                                                                                                                   
  â””â”€ Fallback: 'EPSG:4326'                                                                                                                          
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                         SPECIAL LOCATION HANDLING                            â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  SHAPEFILE_FREE_LOCATIONS = {                                                                                                                      
    'hawaiian_islands',                                                                                                                             
    'mariana_islands',                                                                                                                              
    'samoan_islands',                                                                                                                               
    'western_aleutian_islands'                                                                                                                      
  }                                                                                                                                                 
                                                                                                                                                    
  These locations:                                                                                                                                  
  â”œâ”€ Skip shapefile lookup                                                                                                                          
  â”œâ”€ Skip shapefile cutting                                                                                                                         
  â”œâ”€ Manual warp to EPSG:3857 without cutline                                                                                                       
  â”œâ”€ Marked as "NOT NEEDED" in review report                                                                                                        
  â””â”€ Still included in final mosaic                                                                                                                 
                                                                                                                                                    
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                            FALLBACK LOGIC                                    â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  VRT Library Structure:                                                                                                                            
  vrt_library[location][date] = Path to VRT/TIFF                                                                                                    
                                                                                                                                                    
  For each date being processed:                                                                                                                    
    For each location:                                                                                                                              
      IF location in vrt_library:                                                                                                                   
        IF exact date exists in vrt_library[location]:                                                                                              
          USE vrt_library[location][date]                                                                                                           
        ELSE:                                                                                                                                       
          available_dates = all dates â‰¤ current_date for this location                                                                              
          most_recent = sorted(available_dates)[-1]                                                                                                 
          USE vrt_library[location][most_recent]                                                                                                    
                                                                                                                                                    
  This allows locations without data for a specific date to "fall back"                                                                             
  to the most recent available data from a previous date.                                                                                           
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                         COMPRESSION HANDLING                                 â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  Initialization:                                                                                                                                   
  â”œâ”€ Check GDAL ZSTD support: _check_zstd_support()                                                                                                 
  â”œâ”€ Set self.compression = 'ZSTD' or 'LZW'                                                                                                         
  â””â”€ Log warning on first log() if using LZW fallback                                                                                               
                                                                                                                                                    
  GeoTIFF Creation:                                                                                                                                 
  â”œâ”€ Use self.compression in creation options                                                                                                       
  â”œâ”€ If ZSTD decompression error during create_geotiff():                                                                                           
  â”‚  â””â”€ Automatically retry with LZW compression                                                                                                    
  â””â”€ Used in both warp_and_cut() and create_geotiff()                                                                                               
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                          PERFORMANCE OPTIMIZATIONS                           â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  1. GDAL Configuration (set at init):                                                                                                              
     â”œâ”€ GDAL_CACHEMAX: 75% available RAM (max 8GB)                                                                                                  
     â”œâ”€ GDAL_NUM_THREADS: ALL_CPUS                                                                                                                  
     â”œâ”€ GDAL_SWATH_SIZE: cache_size in bytes                                                                                                        
     â”œâ”€ COMPRESS_OVERVIEW: DEFLATE                                                                                                                  
     â””â”€ GDAL_TIFF_INTERNAL_MASK: YES                                                                                                                
                                                                                                                                                    
  2. Parallel Warp Processing:                                                                                                                      
     â”œâ”€ ThreadPoolExecutor with (cpu_count - 2) workers                                                                                             
     â”œâ”€ All warp jobs for a date submitted in parallel                                                                                              
     â””â”€ Results collected via as_completed()                                                                                                        
                                                                                                                                                    
  3. Compression During Warp:                                                                                                                       
     â”œâ”€ Intermediate warped files compressed                                                                                                        
     â””â”€ Reduces I/O for large files                                                                                                                 
                                                                                                                                                    
  4. File Resolution Fast Paths:                                                                                                                    
     â”œâ”€ Check direct path first before os.walk()                                                                                                    
     â””â”€ Significant speedup for large source directories                                                                                            
                                                                                                                                                    
  5. SRS Caching:                                                                                                                                   
     â”œâ”€ Cache shapefile SRS lookups                                                                                                                 
     â””â”€ Avoid repeated OGR opens                                                                                                                    
                                                                                                                                                    
  6. Multithreaded Compression:                                                                                                                     
     â”œâ”€ NUM_THREADS=ALL_CPUS in create_geotiff()                                                                                                    
     â””â”€ Parallel tile generation (cpu_count - 2 processes)                                                                                          
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                         DOWNLOAD THROTTLING                                  â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  Rate Limiting Strategy:                                                                                                                           
  â”œâ”€ download_delay: configurable seconds between requests (default: 8.0)                                                                           
  â”œâ”€ last_download_time: tracks last successful download                                                                                            
  â”œâ”€ Before each download: check elapsed time                                                                                                       
  â”‚  â””â”€ If < download_delay: sleep(wait_time)                                                                                                       
  â”œâ”€ Retry logic: max 3 attempts with exponential backoff (5â†’10â†’20s)                                                                                
  â”œâ”€ Connection errors: increase download_delay by 1.5Ã— + 5s                                                                                        
  â””â”€ Extra pause after successful download before next request                                                                                      
                                                                                                                                                    
  Preparation Phase (_download_missing_files):                                                                                                      
  â”œâ”€ Collect ALL missing files upfront                                                                                                              
  â”œâ”€ Sort by date (latest â†’ oldest)                                                                                                                 
  â”œâ”€ Download sequentially with throttling                                                                                                          
  â”œâ”€ Extract ZIPs immediately after download                                                                                                        
  â”œâ”€ Log progress: [idx/total] with estimated time                                                                                                  
  â””â”€ All downloads complete BEFORE processing begins                                                                                                
                                                                                                                                                    
  This prevents burst requests and rate limit errors during processing.                                                                             
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                              ERROR HANDLING                                  â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  Download Errors:                                                                                                                                  
  â”œâ”€ Retry up to 3 times with exponential backoff                                                                                                   
  â”œâ”€ Connection reset â†’ increase global download_delay                                                                                              
  â”œâ”€ Clean up partial files on failure                                                                                                              
  â””â”€ Continue processing with available files                                                                                                       
                                                                                                                                                    
  Warp Errors:                                                                                                                                      
  â”œâ”€ Catch exceptions in _warp_worker                                                                                                               
  â”œâ”€ Log detailed error messages                                                                                                                    
  â”œâ”€ Continue with other locations                                                                                                                  
  â””â”€ Skip failed warps (won't be in vrt_library)                                                                                                    
                                                                                                                                                    
  VRT Build Errors:                                                                                                                                 
  â”œâ”€ Validate input files (exists, size >1KB)                                                                                                       
  â”œâ”€ Skip corrupted/empty files                                                                                                                     
  â”œâ”€ Log warnings for skipped files                                                                                                                 
  â””â”€ Proceed with valid files only                                                                                                                  
                                                                                                                                                    
  ZSTD Compression Errors:                                                                                                                          
  â”œâ”€ Detect ZSTD decompression failures in create_geotiff()                                                                                         
  â”œâ”€ Automatically retry with LZW compression                                                                                                       
  â””â”€ Log compression method change                                                                                                                  
                                                                                                                                                    
  Shapefile Errors:                                                                                                                                 
  â”œâ”€ Fallback to 'EPSG:4326' if SRS lookup fails                                                                                                    
  â”œâ”€ Cache fallback results to avoid repeated failures                                                                                              
  â””â”€ Continue processing with fallback SRS                                                                                                          
                                                                                                                                                    
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                                  
  â•‘                           FILE STRUCTURE SUMMARY                             â•‘                                                                  
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                                  
                                                                                                                                                    
  Input Files:                                                                                                                                      
  â”œâ”€ master_dole.csv: date, location, edition, filename, download_link                                                                              
  â”œâ”€ Source TIFFs: /source_dir/filename.tif or /source_dir/dirname/*.tif                                                                            
  â””â”€ Shapefiles: /shapefiles/sectional/**/*.shp                                                                                                     
                                                                                                                                                    
  Temporary Files:                                                                                                                                  
  â”œâ”€ /output/.temp/date/ : Working directory for each date                                                                                          
  â”‚  â”œâ”€ location_file.tif : Warped and cut TIFFs                                                                                                    
  â”‚  â”œâ”€ location_date.vrt : Per-location VRT                                                                                                        
  â”‚  â””â”€ mosaic_date.vrt : Combined mosaic VRT                                                                                                       
  â””â”€ /vsimem/file_rgba.vrt : In-memory RGBA expansion VRTs                                                                                          
                                                                                                                                                    
  Output Files:                                                                                                                                     
  â”œâ”€ date.tif : Compressed GeoTIFF (ZSTD or LZW)                                                                                                    
  â”œâ”€ date.mbtiles : MBTiles with WEBP tiles                                                                                                         
  â”œâ”€ date_tiles/ : Tile pyramid with WEBP tiles                                                                                                     
  â””â”€ processing_review_TIMESTAMP.csv : Review report matrix                                                                                         
                                                                                                                                                    
  Logs:                                                                                                                                             
  Logs:
  â””â”€ Console output with timestamps [HH:MM:SS]

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘                        PARALLELISM DIAGRAM                                  â•‘
  â•‘              (Sequential vs Parallel Execution Flow)                        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                            TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  PHASE 1: INITIALIZATION (Sequential)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Parse   â”‚â”€â”€â–ºâ”‚ Validateâ”‚â”€â”€â–ºâ”‚ Load    â”‚â”€â”€â–ºâ”‚ Review  â”‚
  â”‚ CLI     â”‚   â”‚ Paths   â”‚   â”‚ CSV     â”‚   â”‚ Report  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚             â”‚
  â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º


  PHASE 2: DOWNLOAD PREPARATION (Sequential with throttling)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Download â”‚â”€â”€8sâ”€â”€â–ºâ”‚Download â”‚â”€â”€8sâ”€â”€â–ºâ”‚Download â”‚â”€â”€8sâ”€â”€â–ºâ”‚Download â”‚â”€â”€â–º...
  â”‚ File 1  â”‚ delay â”‚ File 2  â”‚ delay â”‚ File 3  â”‚ delay â”‚ File N  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚                 â”‚
  â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sequential (rate-limited) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚


  PHASE 3: DATE PROCESSING (Sequential dates, Parallel warps)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  DATE 1                          DATE 2                          DATE N
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Prepare Warp Jobs        â”‚   â”‚  Prepare Warp Jobs        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â•”â•â•â•ThreadPoolExecutorâ•â•â•â•—â”‚   â”‚ â•”â•â•â•ThreadPoolExecutorâ•â•â•â•—â”‚
  â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â” â•‘â”‚   â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â” â•‘â”‚
  â”‚ â•‘ â”‚Warp â”‚â”‚Warp â”‚â”‚Warp â”‚ â•‘â”‚   â”‚ â•‘ â”‚Warp â”‚â”‚Warp â”‚â”‚Warp â”‚ â•‘â”‚
  â”‚ â•‘ â”‚Loc1 â”‚â”‚Loc2 â”‚â”‚Loc3 â”‚ â•‘â”‚   â”‚ â•‘ â”‚Loc1 â”‚â”‚Loc2 â”‚â”‚Loc3 â”‚ â•‘â”‚
  â”‚ â•‘ â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜ â•‘â”‚   â”‚ â•‘ â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜ â•‘â”‚
  â”‚ â•‘    â”‚      â”‚      â”‚    â•‘â”‚   â”‚ â•‘    â”‚      â”‚      â”‚    â•‘â”‚
  â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”       â•‘â”‚   â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”       â•‘â”‚
  â”‚ â•‘ â”‚Warp â”‚â”‚Warp â”‚ ...   â•‘â”‚   â”‚ â•‘ â”‚Warp â”‚â”‚Warp â”‚ ...   â•‘â”‚
  â”‚ â•‘ â”‚Loc4 â”‚â”‚Loc5 â”‚       â•‘â”‚   â”‚ â•‘ â”‚Loc4 â”‚â”‚Loc5 â”‚       â•‘â”‚
  â”‚ â•‘ â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜       â•‘â”‚   â”‚ â•‘ â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜       â•‘â”‚
  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚   â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
  â”‚  (cpu_count - 2) workers  â”‚   â”‚  (cpu_count - 2) workers  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Build Mosaic VRT         â”‚   â”‚  Build Mosaic VRT         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Create GeoTIFF (if req)  â”‚   â”‚  Create GeoTIFF (if req)  â”‚
  â”‚  Generate Tiles (if req)  â”‚   â”‚  Generate Tiles (if req)  â”‚
  â”‚  QUEUE MBTiles job â—„â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
              â”‚<â”€â”€â”€â”€â”€ Sequential (one date at a time) â”€â”€â”€â”€â”€>â”‚


  PHASE 4: MBTILES BATCH PROCESSING (Fully Parallel)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  After ALL dates complete, process queued MBTiles jobs in parallel:

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ProcessPoolExecutor â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘                      (--parallel-mbtiles workers, default: 6)              â•‘
  â•‘                                                                            â•‘
  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
  â•‘  â”‚ Process 1  â”‚  â”‚ Process 2  â”‚  â”‚ Process 3  â”‚  â”‚ Process 4  â”‚  ...      â•‘
  â•‘  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚           â•‘
  â•‘  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚           â•‘
  â•‘  â”‚ Date A     â”‚  â”‚ Date B     â”‚  â”‚ Date C     â”‚  â”‚ Date D     â”‚           â•‘
  â•‘  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚           â•‘
  â•‘  â”‚ GDAL       â”‚  â”‚ GDAL       â”‚  â”‚ GDAL       â”‚  â”‚ GDAL       â”‚           â•‘
  â•‘  â”‚ Translate  â”‚  â”‚ Translate  â”‚  â”‚ Translate  â”‚  â”‚ Translate  â”‚           â•‘
  â•‘  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â•‘
  â•‘        â”‚               â”‚               â”‚               â”‚                  â•‘
  â•‘        â–¼               â–¼               â–¼               â–¼                  â•‘
  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
  â•‘  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚  â”‚ MBTiles    â”‚           â•‘
  â•‘  â”‚ Date E     â”‚  â”‚ Date F     â”‚  â”‚ Date G     â”‚  â”‚ Date H     â”‚  ...      â•‘
  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â•‘
  â•‘                                                                            â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚               â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼               â–¼
   [1/N] âœ“         [2/N] âœ“         [3/N] âœ“         [4/N] âœ“
   complete        complete        complete        complete
        â”‚               â”‚               â”‚               â”‚
  â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ True Parallel (separate processes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚


  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            PARALLELISM SUMMARY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     OPERATION      â”‚    EXECUTION TYPE   â”‚           REASON              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Downloads          â”‚ Sequential          â”‚ Rate limiting (8s delay)      â”‚
  â”‚                    â”‚ (throttled)         â”‚ Avoid web.archive.org bans    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Date Loop          â”‚ Sequential          â”‚ Fallback logic depends on     â”‚
  â”‚                    â”‚                     â”‚ previous dates' VRTs          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Warp Operations    â”‚ ThreadPoolExecutor  â”‚ GDAL I/O-bound, GIL released  â”‚
  â”‚ (per date)         â”‚ (parallel)          â”‚ during GDAL operations        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ GeoTIFF Creation   â”‚ Sequential          â”‚ Heavy I/O, NUM_THREADS=       â”‚
  â”‚                    â”‚ (internal parallel) â”‚ ALL_CPUS for compression      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ MBTiles Creation   â”‚ ProcessPoolExecutor â”‚ CPU-bound tile encoding       â”‚
  â”‚ (BATCHED AT END)   â”‚ (true parallel)     â”‚ Bypasses GIL with multiproc   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Why ProcessPoolExecutor for MBTiles?
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ ThreadPoolExecutor: Threads share memory, GIL limits CPU parallelism
  â€¢ ProcessPoolExecutor: Separate processes, true parallel CPU execution
  â€¢ GDAL tile encoding is CPU-intensive â†’ ProcessPoolExecutor is ideal
  â€¢ Each worker re-imports GDAL (required for multiprocessing pickle)

  Why Batch MBTiles at the End?
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ Avoids process spawn overhead during date loop
  â€¢ All VRT files remain valid (temp dirs not cleaned mid-loop)
  â€¢ Maximum parallelism: N MBTiles processed simultaneously
  â€¢ Progress reporting: [i/N] completed messages

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘                                  END                                         â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  This comprehensive ASCII logic map shows every major decision point, data flow,
  and processing step in newslicer.py from initialization through completion,
  including all error handling, fallback logic, and output generation paths.
